<!DOCTYPE html>
<title>Movie happiness rater</title>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{  url_for('static', filename='frontpage.css')  }}">
</head>

<body>
<div class="title">
    Find out if a movie is sad or not
</div>
<div class="dropdown">
    <button onclick="myFunction()" class="dropbtn">Search a movie</button>
    <div id="myDropdown" class="dropdown-content">
        <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
        <ul>
            {% for item in items %}
            <li>
                <button onclick="displayMovieRating('{{ item }}', '{{ scores[loop.index-1] }}')">{{ item }}</button>    
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
<div class="container">
   <img src="{{ url_for('static', filename='scatterplot.png') }}" class="image" />
</div>
<div class="center-box">
    <h2 id="movieTitle"></h2>
    <div class="colored-box" data-value="0.5"></div>
    <p id="movieDescription"></p>
</div>
</body>
<script>
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
    function filterFunction() {
        var input, filter, li, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        div = document.getElementById("myDropdown");
        li = div.getElementsByTagName("li");
        for (i = 0; i < li.length; i++) {
            txtValue = li[i].textContent || li[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }
    function displayMovieRating(movie_title, score) {
        var coloredBox = document.querySelector(".colored-box");
        var score = parseFloat(score)
        var position = (score + 1) * 50; // Calculate position as a number between 0 and 100

        coloredBox.setAttribute("data-value", Math.round(score * 100) / 100);
        coloredBox.style.setProperty("--line-position", position + "%");

        var movieTitleElement = document.getElementById("movieTitle");
        movieTitleElement.textContent = movie_title;
        console.log(score)
        // Set the movie description below the colored box based on the score
        var movieDescriptionElement = document.getElementById("movieDescription");
        if (score >= 0.5) {
            movieDescriptionElement.textContent = `According to our algorithm ${movie_title} is a happy movie`;
        } 
        else if (score <= -0.5) {
            movieDescriptionElement.textContent = `According to our algorithm ${movie_title} is a sad movie`;
        }
        else if (-0.15 > score && score > -0.5) {
            movieDescriptionElement.textContent = `According to our algorithm ${movie_title} is on the sadder side of movies`;
        }
        else if (0.15 < score && score < 0.5) {
            movieDescriptionElement.textContent = `According to our algorithm ${movie_title} is on the happier side of movies`;
        }
        else {
            movieDescriptionElement.textContent = `According to our algorithm ${movie_title} is neutral on the happy-sad scale`
        }
        }
    
</script>